!function(root,factory){"function"==typeof define&&define.amd?define([],function(){return root.lory=factory()}):"object"==typeof exports?module.exports=factory():root.lory=factory()}(this,function(){"use strict";var clamp=function(min,max){if("undefined"==typeof max&&(max=min,min=0),min>max){var tmp=min;min=max,max=tmp}return function(value){return Math.min(Math.max(value,min),max)}},mergeOptions=function(opts,defaultOptions){var options={};return Object.keys(defaultOptions).map(function(key){options[key]=opts&&opts.hasOwnProperty(key)?opts[key]:defaultOptions[key]}),options},lory=function(slider,opts){var position,slidesWidth,frameWidth,slides,transitionEndCallback,index=0,options={};"undefined"!=typeof jQuery&&slider instanceof jQuery&&(slider=slider[0]);var touchOffset,delta,isScrolling,frame=slider.querySelector(".js_frame"),slideContainer=frame.querySelector(".js_slides"),prevCtrl=slider.querySelector(".js_prev"),nextCtrl=slider.querySelector(".js_next"),defaults={slidesToScroll:1,slideSpeed:300,rewindSpeed:600,snapBackSpeed:200,ease:"ease",rewind:!1,infinite:!1,beforeInit:function(){return!0},afterInit:function(){return!0},beforePrev:function(){return!0},beforeNext:function(){return!0},beforeMove:function(){return!0},beforeResize:function(){return!0}},setupInfinite=function(slideArray){var front=slideArray.slice(0,options.infinite),back=slideArray.slice(slideArray.length-options.infinite,slideArray.length);return front.forEach(function(element){var cloned=element.cloneNode(!0);slideContainer.appendChild(cloned)}),back.reverse().forEach(function(element){var cloned=element.cloneNode(!0);slideContainer.insertBefore(cloned,slideContainer.firstChild)}),slideContainer.addEventListener("webkitTransitionEnd",onTransitionEnd),slideContainer.addEventListener("msTransitionEnd",onTransitionEnd),slideContainer.addEventListener("oTransitionEnd",onTransitionEnd),slideContainer.addEventListener("otransitionend",onTransitionEnd),slideContainer.addEventListener("transitionend",onTransitionEnd),Array.prototype.slice.call(slideContainer.children)},setup=function(){options=mergeOptions(opts,defaults),options.beforeInit(),position={x:slideContainer.offsetLeft,y:slideContainer.offsetTop},slides=options.infinite?setupInfinite(Array.prototype.slice.call(slideContainer.children)):Array.prototype.slice.call(slideContainer.children),resetSlider(),prevCtrl&&nextCtrl&&(prevCtrl.addEventListener("click",prev),nextCtrl.addEventListener("click",next)),slideContainer.addEventListener("touchstart",onTouchstart),window.addEventListener("resize",onResize),options.afterInit()},resetSlider=function(){slidesWidth=slideContainer.getBoundingClientRect().width||slideContainer.offsetWidth,frameWidth=frame.getBoundingClientRect().width||frame.offsetWidth,index=0,options.infinite?(translate(-1*slides[index+options.infinite].offsetLeft,0,null),index+=options.infinite,position.x=-1*slides[index].offsetLeft):translate(0,options.rewindSpeed,options.ease)},prev=function(){options.beforePrev(),slide(!1,!1)},next=function(){options.beforeNext(),slide(!1,!0)},translate=function(to,duration,ease){var style=slideContainer&&slideContainer.style;style&&(style.webkitTransitionTimingFunction=style.MozTransitionTimingFunction=style.msTransitionTimingFunction=style.OTransitionTimingFunction=style.transitionTimingFunction=ease,style.webkitTransitionDuration=style.MozTransitionDuration=style.msTransitionDuration=style.OTransitionDuration=style.transitionDuration=duration+"ms",style.webkitTransform="translate3d("+to+"px, 0, 0)",style.msTransform=style.MozTransform=style.OTransform="translateX("+to+"px)")},slide=function(nextIndex,direction){var maxOffset=slidesWidth-frameWidth,limitIndex=clamp(0,slides.length-1),limitOffset=clamp(-1*maxOffset,0),duration=options.slideSpeed;"number"!=typeof nextIndex&&(nextIndex=direction?index+options.slidesToScroll:index-options.slidesToScroll),nextIndex=limitIndex(nextIndex),options.infinite&&void 0===direction&&(nextIndex+=options.infinite);var nextOffset=limitOffset(-1*slides[nextIndex].offsetLeft);options.rewind&&Math.abs(position.x)===maxOffset&&direction&&(nextOffset=0,nextIndex=0,duration=options.rewindSpeed),translate(nextOffset,duration,options.ease),position.x=nextOffset,slides[nextIndex].offsetLeft<=maxOffset&&(index=nextIndex),options.infinite&&Math.abs(nextOffset)===maxOffset&&direction&&(index=options.infinite,position.x=-1*slides[index].offsetLeft,transitionEndCallback=function(){translate(-1*slides[index].offsetLeft,0,null)}),options.infinite&&0===Math.abs(nextOffset)&&!direction&&(index=slides.length-2*options.infinite,position.x=-1*slides[index].offsetLeft,transitionEndCallback=function(){translate(-1*slides[index].offsetLeft,0,null)})},onTransitionEnd=function(){transitionEndCallback&&(transitionEndCallback(),transitionEndCallback=void 0)},onTouchstart=function(event){options.beforeMove();var touches=event.touches[0];touchOffset={x:touches.pageX,y:touches.pageY,time:Date.now()},isScrolling=void 0,delta={},slideContainer.addEventListener("touchmove",onTouchmove),slideContainer.addEventListener("touchend",onTouchend)},onTouchmove=function(event){var touches=event.touches[0];delta={x:touches.pageX-touchOffset.x,y:touches.pageY-touchOffset.y},"undefined"==typeof isScrolling&&(isScrolling=!!(isScrolling||Math.abs(delta.x)<Math.abs(delta.y))),isScrolling||translate(position.x+delta.x,0,null)},onTouchend=function(){var duration=Date.now()-touchOffset.time,isValid=Number(duration)<300&&Math.abs(delta.x)>25||Math.abs(delta.x)>frameWidth/3,isOutOfBounds=!index&&delta.x>0||index===slides.length-1&&delta.x<0,direction=delta.x<0;isScrolling||(isValid&&!isOutOfBounds?slide(!1,direction):translate(position.x,options.snapBackSpeed)),frame.removeEventListener("touchmove"),frame.removeEventListener("touchend")},onResize=function(){options.beforeResize(),resetSlider()};return setup(),{setup:function(){setup()},reset:function(){resetSlider()},slideTo:function(index){slide(index)},prev:prev,next:next}};return lory});